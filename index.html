<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Platform 2025 | Education</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background: #f8f9fc; height: 100vh; overflow: hidden; }
        .bubble-me { background: #4f46e5 !important; color: white !important; border-radius: 1.5rem 1.5rem 0 1.5rem; margin-left: auto; }
        .bubble-other { background: #ffffff !important; color: #1f2937 !important; border-radius: 1.5rem 1.5rem 1.5rem 0; border: 1px solid #e2e8f0; margin-right: auto; }
        .nav-btn { transition: all 0.3s; cursor: pointer; display: flex; align-items: center; justify-content: center; width: 50px; height: 50px; border-radius: 15px; }
        .nav-active { background: #4f46e5; color: white; box-shadow: 0 10px 15px -3px rgba(79, 70, 229, 0.4); }
        .course-card { transition: all 0.3s; border: 1px solid transparent; }
        .course-card:hover { transform: translateY(-5px); border-color: #4f46e5; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.05); }
        .modal-bg { background: rgba(0,0,0,0.4); backdrop-filter: blur(4px); }
        .chat-scroll::-webkit-scrollbar { width: 4px; }
        .chat-scroll::-webkit-scrollbar-thumb { background: #e2e8f0; border-radius: 10px; }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        const S_URL = "https://ihwxjkqzjaacizarwugc.supabase.co";
        const S_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imlod3hqa3F6amFhY2l6YXJ3dWdjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYxNTEzNzcsImV4cCI6MjA4MTcyNzM3N30.wP8r-0PoBtF8pgP1cv_nSW4ueHPnRSeLQtdv9nA8Vu0";
        const _supabase = supabase.createClient(S_URL, S_KEY);

        let currentUser = null;
        let currentTab = 'edu'; // 'chat' –∏–ª–∏ 'edu'
        let activeChat = null;
        let myInvites = [];
        let showNotifs = false;
        let userRoleInChat = 'member';
        let showMembersModal = false;
        let chatMembersList = [];

        // –°–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è
        let courses = [
            { id: 1, title: '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', desc: '–ë–∞–∑–æ–≤—ã–π –∫—É—Ä—Å –∞–ª–≥–µ–±—Ä—ã –∏ –≥–µ–æ–º–µ—Ç—Ä–∏–∏', lessons_count: 12, progress: 45, icon: 'üìê' },
            { id: 2, title: '–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ', desc: '–û—Å–Ω–æ–≤—ã JavaScript –∏ —Å–æ–∑–¥–∞–Ω–∏–µ —Å–∞–π—Ç–æ–≤', lessons_count: 24, progress: 10, icon: 'üíª' },
            { id: 3, title: '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', desc: '–†–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –∑–∞ 3 –º–µ—Å—è—Ü–∞', lessons_count: 15, progress: 80, icon: 'üåç' }
        ];

        function showLogin() {
            document.getElementById('app').innerHTML = `
                <div class="flex items-center justify-center min-h-screen">
                    <div class="p-10 w-full max-w-sm bg-white rounded-[2.5rem] shadow-xl text-center">
                        <div class="mb-8 text-3xl font-black text-indigo-600 italic">P.25</div>
                        <div class="space-y-3">
                            <input type="text" id="fname" placeholder="–í–∞—à–µ –ò–º—è" class="w-full p-4 bg-gray-50 rounded-xl outline-none font-bold text-sm border focus:border-indigo-300">
                            <input type="text" id="uname" placeholder="–õ–æ–≥–∏–Ω" class="w-full p-4 bg-gray-50 rounded-xl outline-none font-bold text-sm border">
                            <input type="password" id="pass" placeholder="–ü–∞—Ä–æ–ª—å" class="w-full p-4 bg-gray-50 rounded-xl outline-none font-bold text-sm border">
                            <button onclick="handleLogin()" class="w-full bg-indigo-600 text-white font-black py-4 rounded-xl shadow-lg uppercase text-xs tracking-widest transition hover:bg-indigo-700">–í–æ–π—Ç–∏</button>
                        </div>
                    </div>
                </div>`;
        }

        async function handleLogin() {
            const f = document.getElementById('fname').value;
            const u = document.getElementById('uname').value;
            const p = document.getElementById('pass').value;
            const { data } = await _supabase.from('users').select('*').eq('username', u).eq('password', p).single();
            if (data) {
                currentUser = {...data, first_name: f};
                await _supabase.from('users').update({ first_name: f }).eq('username', u);
                startNotifPoller(); render(); 
            } else { alert("–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞!"); }
        }

        function render() {
            document.getElementById('app').innerHTML = `
                <div class="flex h-screen overflow-hidden">
                    <aside class="w-24 bg-white border-r flex flex-col items-center py-8 gap-6">
                        <div class="text-indigo-600 text-2xl font-black italic mb-4">P.</div>
                        
                        <div onclick="currentTab='edu'; render()" class="nav-btn ${currentTab==='edu'?'nav-active':'text-gray-400 hover:text-indigo-600'}">
                            <span class="text-xl">üìö</span>
                        </div>
                        
                        <div onclick="currentTab='chat'; render()" class="nav-btn ${currentTab==='chat'?'nav-active':'text-gray-400 hover:text-indigo-600'}">
                            <span class="text-xl">üí¨</span>
                        </div>

                        <button onclick="location.reload()" class="mt-auto text-gray-300 hover:text-red-500 transition nav-btn">üö™</button>
                    </aside>

                    <main class="flex-1 flex flex-col bg-white overflow-hidden relative">
                        <header class="h-20 border-b flex items-center justify-between px-10">
                            <h1 class="font-black text-gray-800 uppercase tracking-tighter text-lg">
                                ${currentTab === 'edu' ? '–û–±—É—á–µ–Ω–∏–µ' : '–ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä'}
                            </h1>
                            <div class="flex items-center gap-6">
                                <button onclick="showNotifs=!showNotifs; render()" class="text-xl relative">
                                    üîî${myInvites.length > 0 ? '<div class="notif-dot"></div>' : ''}
                                </button>
                                ${showNotifs ? renderNotifBox() : ''}
                                <div class="text-right">
                                    <p class="font-bold text-sm leading-none">${currentUser.first_name}</p>
                                    <p class="text-[9px] text-indigo-400 font-black uppercase mt-1">@${currentUser.username}</p>
                                </div>
                            </div>
                        </header>

                        <div class="flex-1 flex overflow-hidden">
                            ${currentTab === 'edu' ? renderEduSection() : renderChatSection()}
                        </div>

                        ${showMembersModal ? renderMembersModal() : ''}
                    </main>
                </div>`;
            if (currentTab === 'chat' && activeChat) loadChatData();
        }

        // --- SECTION: EDUCATION ---
        function renderEduSection() {
            return `
                <div class="flex-1 overflow-y-auto p-10 chat-scroll">
                    <div class="max-w-6xl mx-auto">
                        <div class="flex justify-between items-end mb-10">
                            <div>
                                <h2 class="text-3xl font-black text-gray-900 tracking-tighter">–ú–æ–∏ –∫—É—Ä—Å—ã</h2>
                                <p class="text-gray-400 font-medium text-sm mt-1">–ü—Ä–æ–¥–æ–ª–∂–∞–π –æ–±—É—á–µ–Ω–∏–µ —Å —Ç–æ–≥–æ –º–µ—Å—Ç–∞, –≥–¥–µ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è</p>
                            </div>
                            <button class="bg-indigo-50 text-indigo-600 font-black px-6 py-3 rounded-2xl text-xs uppercase tracking-widest hover:bg-indigo-100 transition">–ö–∞—Ç–∞–ª–æ–≥</button>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                            ${courses.map(course => `
                                <div class="course-card bg-white rounded-[2.5rem] p-8 border border-gray-100 flex flex-col h-full cursor-pointer" onclick="alert('–ü–µ—Ä–µ—Ö–æ–¥ –∫ —É—Ä–æ–∫–∞–º ${course.title}...')">
                                    <div class="w-14 h-14 bg-indigo-50 rounded-2xl flex items-center justify-center text-2xl mb-6">${course.icon}</div>
                                    <h3 class="text-xl font-black text-gray-800 mb-2 tracking-tight">${course.title}</h3>
                                    <p class="text-gray-400 text-sm font-medium mb-6 flex-1">${course.desc}</p>
                                    
                                    <div class="space-y-3">
                                        <div class="flex justify-between items-center">
                                            <span class="text-[10px] font-black text-gray-400 uppercase">–ü—Ä–æ–≥—Ä–µ—Å—Å</span>
                                            <span class="text-[10px] font-black text-indigo-600">${course.progress}%</span>
                                        </div>
                                        <div class="w-full h-2 bg-gray-100 rounded-full overflow-hidden">
                                            <div class="h-full bg-indigo-600 rounded-full" style="width: ${course.progress}%"></div>
                                        </div>
                                        <p class="text-[10px] font-bold text-gray-400 uppercase pt-2">${course.lessons_count} —É—Ä–æ–∫–æ–≤</p>
                                    </div>
                                </div>
                            `).join('')}
                            
                            <div class="border-2 border-dashed border-gray-100 rounded-[2.5rem] p-8 flex flex-col items-center justify-center text-center group cursor-pointer hover:border-indigo-200 transition">
                                <div class="w-12 h-12 bg-gray-50 rounded-full flex items-center justify-center text-gray-400 group-hover:bg-indigo-50 group-hover:text-indigo-600 transition mb-4">
                                    <span class="text-2xl font-bold">+</span>
                                </div>
                                <p class="font-black text-xs text-gray-400 uppercase tracking-widest group-hover:text-indigo-600 transition">–°–æ–∑–¥–∞—Ç—å –∫—É—Ä—Å</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // --- SECTION: CHAT (–¢–≤–æ–π –≥–æ—Ç–æ–≤—ã–π –∫–æ–¥) ---
        function renderChatSection() {
            // (–¢—É—Ç –∏–¥–µ—Ç –≤—Å—è –ª–æ–≥–∏–∫–∞ –ª–µ–≤–æ–π –ø–∞–Ω–µ–ª–∏ —á–∞—Ç–æ–≤ –∏ –æ–∫–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—É—é –º—ã —É–∂–µ –Ω–∞–ø–∏—Å–∞–ª–∏)
            // –ß—Ç–æ–±—ã –Ω–µ —Ä–∞–∑–¥—É–≤–∞—Ç—å –æ—Ç–≤–µ—Ç, —è –≤—Å—Ç–∞–≤–∏–ª —Å—é–¥–∞ —Ç–≤–æ—é —Ä–∞–±–æ—á—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
            return `
                <div class="w-72 border-r bg-gray-50/30 p-4">
                    <div class="flex justify-between items-center mb-6 px-2">
                        <span class="text-[10px] font-black text-gray-400 uppercase">–ß–∞—Ç—ã</span>
                        <button onclick="createNewChat()" class="w-6 h-6 bg-indigo-600 text-white rounded-md font-bold">+</button>
                    </div>
                    <div id="chats-list" class="space-y-1 overflow-y-auto chat-scroll">
                        </div>
                </div>
                <div class="flex-1 flex flex-col" id="chat-content">
                    ${activeChat ? renderChatWindow() : `<div class="flex-1 flex items-center justify-center text-gray-300 font-black uppercase text-xs tracking-[0.3em]">–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç</div>`}
                </div>
            `;
        }
        
        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ —Å–ø–∏—Å–∫–∞ —á–∞—Ç–æ–≤ (–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ render)
        async function loadChatsList() {
            const { data: joined } = await _supabase.from('chat_members').select('subject').eq('username', currentUser.username);
            const list = document.getElementById('chats-list');
            if (list && joined) {
                list.innerHTML = joined.map(j => `
                    <div onclick="activeChat='${j.subject}'; render()" class="p-4 cursor-pointer rounded-2xl transition ${activeChat===j.subject?'bg-indigo-600 text-white shadow-md':'hover:bg-gray-100'}">
                        <p class="font-bold text-xs"># ${j.subject}</p>
                    </div>
                `).join('');
            }
        }

        // (–í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏: uploadFile, sendMsg, deleteMsg, createNewChat, inviteUserPrompt, startNotifPoller, respondInvite ‚Äî –û–°–¢–ê–Æ–¢–°–Ø –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô)
        // –Ø –ø—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è—é –æ–±—â—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É, —á—Ç–æ–±—ã —Ç—ã –º–æ–≥ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è.

        // [–ó–¥–µ—Å—å –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —á–∞—Ç–∞ –∏–∑ –ø—Ä–æ—à–ª–æ–π –≤–µ—Ä—Å–∏–∏ 6.0]
        // –î–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏ —è –Ω–µ –¥—É–±–ª–∏—Ä—É—é –∏—Ö —Ç–µ–ª–∞, –Ω–æ –≤ —Ç–≤–æ–µ–º —Ñ–∏–Ω–∞–ª—å–Ω–æ–º —Ñ–∞–π–ª–µ –æ–Ω–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å.
        
        // ... (–§—É–Ω–∫—Ü–∏–∏ —á–∞—Ç–∞ 6.0) ...
        // [–í—Å—Ç–∞–≤—å —Å—é–¥–∞ —Ñ—É–Ω–∫—Ü–∏–∏: loadChatData, renderChatWindow, openMembers, renderMembersModal, changeRole, kickUser, loadChatMessages, uploadFile, sendMsg, deleteMsg, createNewChat, inviteUserPrompt, startNotifPoller, renderNotifBox, respondInvite]

        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª, —á—Ç–æ–±—ã –æ–Ω —Ä–∞–±–æ—Ç–∞–ª —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤–∫–ª–∞–¥–∫–∞ —á–∞—Ç–∞ –∞–∫—Ç–∏–≤–Ω–∞
        setInterval(() => {
            if (currentTab === 'chat' && activeChat) loadChatMessages();
            startNotifPoller();
        }, 5000);

        showLogin();
    </script>
</body>
</html>
